<?php
/**
 * Generated by Haxe 4.3.6
 */

use \php\_Boot\HxAnon;
use \php\Boot;
use \sys\io\File;
use \haxe\Json;
use \php\_Boot\HxString;
use \haxe\io\Bytes;

class Root {
	/**
	 * @return void
	 */
	public function __construct () {
	}

	/**
	 * @param string $nombre
	 * @param string $capitulo
	 * 
	 * @return string
	 */
	public function Hojas ($nombre, $capitulo) {
		#src/Server.hx:93: characters 9-39
		$Root = "/mnt/proyectos";
		#src/Server.hx:94: characters 9-35
		$hojas = new \Array_hx();
		#src/Server.hx:95: characters 9-58
		$capitulo = \StringTools::replace($capitulo, "-", ".");
		#src/Server.hx:96: characters 9-53
		$nombre = \StringTools::replace($nombre, " ", "_");
		#src/Server.hx:97: characters 9-60
		$baseDir = ($Root??'null') . ("/" . ($nombre??'null') . "/" . ($capitulo??'null'));
		#src/Server.hx:98: lines 98-109
		if (is_dir($baseDir)) {
			#src/Server.hx:99: characters 13-60
			$iterator = new \FilesystemIterator($baseDir);
			#src/Server.hx:100: lines 100-103
			while ($iterator->valid()) {
				#src/Server.hx:101: characters 16-78
				$x = \Std::parseInt((HxString::split($iterator->getFilename(), ".")->arr[0] ?? null));
				$hojas->arr[$hojas->length++] = $x;
				#src/Server.hx:102: characters 16-31
				$iterator->next();
			}
			#src/Server.hx:104: characters 13-37
			usort($hojas->arr, function ($a, $b) {
				#src/Server.hx:104: characters 33-36
				return $a - $b;
			});
			#src/Server.hx:105: characters 13-85
			$ListCaps = \BaseData::ListCaps(\StringTools::replace($nombre, "_", " "));
			#src/Server.hx:106: characters 20-101
			return Json::phpJsonEncode(new HxAnon([
				"Succes" => true,
				"Hojas" => $hojas,
				"name" => $nombre,
				"capitulos" => $ListCaps,
			]), null, null);
		} else {
			#src/Server.hx:108: characters 20-52
			return Json::phpJsonEncode(new HxAnon(["Succes" => false]), null, null);
		}
	}

	/**
	 * @param string $nombre
	 * @param string $capitulo
	 * @param string $pag
	 * @param string $portada
	 * 
	 * @return Bytes
	 */
	public function Leer ($nombre, $capitulo = null, $pag = null, $portada = null) {
		#src/Server.hx:53: characters 9-39
		$Root = "/mnt/proyectos";
		#src/Server.hx:54: characters 9-32
		$imgDir = "";
		#src/Server.hx:55: characters 9-27
		$dataImg = null;
		#src/Server.hx:56: characters 9-53
		$nombre = \StringTools::replace($nombre, " ", "_");
		#src/Server.hx:57: characters 9-34
		error_log($portada);
		#src/Server.hx:58: lines 58-64
		if ($capitulo === null) {
			#src/Server.hx:59: characters 13-59
			$portada = \StringTools::replace($portada, "-", ".");
			#src/Server.hx:60: characters 13-48
			$imgDir = ($Root??'null') . ("/" . ($nombre??'null') . "/" . ($portada??'null'));
		} else {
			#src/Server.hx:62: characters 13-61
			$capitulo = \StringTools::replace($capitulo, "-", ".");
			#src/Server.hx:63: characters 13-61
			$imgDir = ($Root??'null') . ("/" . ($nombre??'null') . "/" . ($capitulo??'null') . "/" . ($pag??'null')) . ".svg";
		}
		#src/Server.hx:66: lines 66-72
		if (file_exists($imgDir)) {
			#src/Server.hx:67: characters 13-44
			$dataImg = File::getBytes($imgDir);
		} else {
			#src/Server.hx:70: characters 13-63
			$dataImg = File::getBytes(($Root??'null') . "/errors/oops.svg");
			#src/Server.hx:71: characters 13-48
			error_log("AAAAAAA Monikaa");
		}
		#src/Server.hx:74: characters 9-31
		$type = "";
		#src/Server.hx:75: characters 17-42
		$__hx__switch = (pathinfo($imgDir, 4));
		if ($__hx__switch === "jpg") {
			#src/Server.hx:79: characters 17-29
			$type = "jpg";
		} else if ($__hx__switch === "png") {
			#src/Server.hx:77: characters 17-29
			$type = "png";
		} else if ($__hx__switch === "svg") {
			#src/Server.hx:83: characters 17-33
			$type = "svg+xml";
		} else if ($__hx__switch === "webp") {
			#src/Server.hx:81: characters 17-29
			$type = "webp";
		}
		#src/Server.hx:85: characters 9-51
		header("Content-Type: image/" . ($type??'null'));
		#src/Server.hx:86: characters 9-23
		return $dataImg;
	}

	/**
	 * @return string
	 */
	public function home () {
		#src/Server.hx:39: characters 9-71
		return "Nyna esta es tu hpta pagina, ahora dame a la niÃ±a >:v";
	}

	/**
	 * @param string $name
	 * 
	 * @return string
	 */
	public function manga ($name = null) {
		#src/Server.hx:47: characters 16-76
		if ($name === null) {
			#src/Server.hx:47: characters 33-48
			return \BaseData::Home();
		} else {
			#src/Server.hx:47: characters 51-76
			return \BaseData::getProyect($name);
		}
	}
}

Boot::registerClass(Root::class, 'Root');
