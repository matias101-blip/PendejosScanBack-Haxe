<?php
/**
 * Generated by Haxe 4.3.6
 */

namespace tink\core\_Future;

use \tink\core\_Callback\LinkPair;
use \tink\core\_Lazy\LazyFunc;
use \haxe\Timer;
use \tink\core\_Lazy\LazyObject;
use \php\Boot;
use \haxe\ds\Either;
use \tink\core\LinkObject;
use \tink\core\_Callback\Callback_Impl_;
use \tink\core\FutureStatus;
use \tink\core\Outcome;
use \tink\core\CallbackLinkRef;
use \tink\core\FutureTrigger;
use \tink\core\_Lazy\LazyConst;
use \tink\core\OutcomeTools;
use \tink\core\_Lazy\Lazy_Impl_;
use \tink\core\MPair;
use \tink\core\_Callback\CallbackLink_Impl_;
use \tink\core\_Outcome\OutcomeMapper_Impl_;

final class Future_Impl_ {
	/**
	 * @var FutureObject
	 */
	static public $NEVER;
	/**
	 * @var FutureObject
	 */
	static public $NEVER_INST;
	/**
	 * @var FutureObject
	 */
	static public $NOISE;

	/**
	 * @param FutureObject $f
	 * @param \Closure $map
	 * 
	 * @return FutureObject
	 */
	public static function _flatMap ($f, $map) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:362: characters 5-26
		return Future_Impl_::flatMap($f, $map);
	}

	/**
	 * @param FutureObject $f
	 * @param \Closure $map
	 * 
	 * @return FutureObject
	 */
	public static function _map ($f, $map) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:365: characters 5-22
		return Future_Impl_::map($f, $map);
	}

	/**
	 * Create a lazy and suspendable `Future` instance from a given `wakeup` function.
	 * The `wakeup` function will be only called when the `Future` is handled for the first time
	 * by using either `handle` or `eager` methods.
	 * The `CallbackLink` returned by the `wakeup` function will be cancelled when the future
	 * is suspended: either before it is triggered or when the last `handle` callback is removed.
	 * 
	 * @param \Closure $wakeup
	 * 
	 * @return FutureObject
	 */
	public static function _new ($wakeup) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:50: character 3
		return new SuspendableFuture($wakeup);
	}

	/**
	 * @param FutureObject $f
	 * @param \Closure $map
	 * 
	 * @return FutureObject
	 */
	public static function _tryFailingFlatMap ($f, $map) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:344: lines 344-347
		return Future_Impl_::flatMap($f, function ($o) use (&$map) {
			$__hx__switch = ($o->index);
			if ($__hx__switch === 0) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:345: characters 20-21
				$d = $o->params[0];
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:345: characters 24-30
				return $map($d);
			} else if ($__hx__switch === 1) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:346: characters 20-21
				$f = $o->params[0];
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:346: characters 24-47
				return new SyncFuture(new LazyConst(Outcome::Failure($f)));
			}
		});
	}

	/**
	 * @param FutureObject $f
	 * @param \Closure $map
	 * 
	 * @return FutureObject
	 */
	public static function _tryFailingMap ($f, $map) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:356: characters 5-53
		return Future_Impl_::map($f, function ($o) use (&$map) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:356: characters 31-52
			return OutcomeTools::flatMap($o, OutcomeMapper_Impl_::withSameError($map));
		});
	}

	/**
	 * @param FutureObject $f
	 * @param \Closure $map
	 * 
	 * @return FutureObject
	 */
	public static function _tryFlatMap ($f, $map) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:350: lines 350-353
		return Future_Impl_::flatMap($f, function ($o) use (&$map) {
			$__hx__switch = ($o->index);
			if ($__hx__switch === 0) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:351: characters 20-21
				$d = $o->params[0];
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:351: characters 24-43
				return Future_Impl_::map($map($d), Boot::getStaticClosure(Outcome::class, 'Success'));
			} else if ($__hx__switch === 1) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:352: characters 20-21
				$f = $o->params[0];
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:352: characters 24-47
				return new SyncFuture(new LazyConst(Outcome::Failure($f)));
			}
		});
	}

	/**
	 * @param FutureObject $f
	 * @param \Closure $map
	 * 
	 * @return FutureObject
	 */
	public static function _tryMap ($f, $map) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:359: characters 5-49
		return Future_Impl_::map($f, function ($o) use (&$map) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:359: characters 31-48
			return OutcomeTools::map($o, $map);
		});
	}

	/**
	 *  Uses `Pair` to merge two futures
	 * 
	 * @param FutureObject $a
	 * @param FutureObject $b
	 * 
	 * @return FutureObject
	 */
	public static function and ($a, $b) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:341: characters 5-61
		return Future_Impl_::merge($a, $b, function ($a, $b) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:341: characters 46-60
			return new MPair($a, $b);
		});
	}

	/**
	 *  Casts a Surprise into a Promise
	 * 
	 * @param FutureObject $s
	 * 
	 * @return FutureObject
	 */
	public static function asPromise ($s) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:197: characters 5-13
		return $s;
	}

	/**
	 * @param \Closure $init
	 * @param bool $lazy
	 * 
	 * @return FutureObject
	 */
	public static function async ($init, $lazy = false) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:312: lines 312-315
		if ($lazy === null) {
			$lazy = false;
		}
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:313: characters 5-34
		$ret = Future_Impl_::irreversible($init);
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:314: characters 12-42
		if ($lazy) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:314: characters 22-25
			return $ret;
		} else {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:314: characters 31-42
			$ret->eager();
			return $ret;
		}
	}

	/**
	 * @param int $ms
	 * @param LazyObject $value
	 * 
	 * @return FutureObject
	 */
	public static function delay ($ms, $value) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:376: characters 12-102
		$this1 = Future_Impl_::irreversible(function ($cb) use (&$ms, &$value) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:376: characters 45-93
			Timer::delay(function () use (&$cb, &$value) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:376: characters 73-88
				$cb(Lazy_Impl_::get($value));
			}, $ms);
		});
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:376: characters 12-102
		$this1->eager();
		return $this1;
	}

	/**
	 *  Makes this future eager.
	 *  Futures are lazy by default, i.e. it does not try to fetch the result until someone `handle` it
	 * 
	 * @param FutureObject $this
	 * 
	 * @return FutureObject
	 */
	public static function eager ($this1) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:67: characters 5-17
		$this1->eager();
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:68: characters 5-16
		return $this1;
	}

	/**
	 *  Same as `first`, but use `Either` to handle the two different types
	 * 
	 * @param FutureObject $a
	 * @param FutureObject $b
	 * 
	 * @return FutureObject
	 */
	public static function either ($a, $b) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:335: characters 5-57
		return Future_Impl_::first(Future_Impl_::map($a, Boot::getStaticClosure(Either::class, 'Left')), Future_Impl_::map($b, Boot::getStaticClosure(Either::class, 'Right')));
	}

	/**
	 *  Creates a future that contains the first result from `this` or `that`
	 * 
	 * @param FutureObject $this
	 * @param FutureObject $that
	 * 
	 * @return FutureObject
	 */
	public static function first ($this1, $that) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:80: characters 20-36
		$_g = $this1;
		$_g1 = $_g->getStatus();
		$__hx__switch = ($_g1->index);
		if ($__hx__switch === 3) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:83: characters 33-34
			$_g2 = $_g1->params[0];
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:80: characters 38-42
			$_g1 = $that->getStatus();
			$__hx__switch = ($_g1->index);
			if ($__hx__switch === 3) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:84: characters 36-37
				$_g2 = $_g1->params[0];
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:82: characters 13-14
				$v = $_g;
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:85: characters 10-11
				return $v;
			} else if ($__hx__switch === 4) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:82: characters 13-14
				$v = $_g;
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:85: characters 10-11
				return $v;
			} else {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:82: characters 13-14
				$v = $_g;
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:85: characters 10-11
				return $v;
			}
		} else if ($__hx__switch === 4) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:81: characters 36-37
			$v = $that;
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:85: characters 10-11
			return $v;
		} else {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:80: characters 38-42
			$_g1 = $that->getStatus();
			$__hx__switch = ($_g1->index);
			if ($__hx__switch === 3) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:84: characters 36-37
				$_g2 = $_g1->params[0];
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:81: characters 36-37
				$v = $that;
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:85: characters 10-11
				return $v;
			} else if ($__hx__switch === 4) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:82: characters 13-14
				$v = $_g;
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:85: characters 10-11
				return $v;
			} else {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:87: characters 9-80
				return new SuspendableFuture(function ($fire) use (&$that, &$this1) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:87: characters 42-79
					$this2 = $this1->handle($fire);
					return new LinkPair($this2, $that->handle($fire));
				});
			}
		}
	}

	/**
	 *  Creates a new future by applying a transform function to the result.
	 *  Different from `map`, the transform function of `flatMap` returns a `Future`
	 * 
	 * @param FutureObject $this
	 * @param \Closure $next
	 * @param bool $gather
	 * 
	 * @return FutureObject
	 */
	public static function flatMap ($this1, $next, $gather = null) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:106: characters 19-25
		$_g = $this1->getStatus();
		$__hx__switch = ($_g->index);
		if ($__hx__switch === 3) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:108: characters 18-19
			$l = $_g->params[0];
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:109: characters 9-77
			return new SuspendableFuture(function ($fire) use (&$next, &$l) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:109: characters 42-76
				return $next(Lazy_Impl_::get($l))->handle(function ($v) use (&$fire) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:109: characters 68-75
					$fire($v);
				});
			});
		} else if ($__hx__switch === 4) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:107: characters 23-30
			return Future_Impl_::never();
		} else {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:111: lines 111-115
			return new SuspendableFuture(function ($yield) use (&$next, &$this1) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:112: characters 11-47
				$inner = new CallbackLinkRef();
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:113: characters 11-78
				$outer = $this1->handle(function ($v) use (&$yield, &$next, &$inner) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:113: characters 42-76
					$param = $next($v)->handle($yield);
					$this1 = $inner->link;
					if ($this1 !== null) {
						$this1->cancel();
					}
					$inner->link = $param;
				});
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:114: characters 11-35
				return new LinkPair($outer, $inner);
			});
		}
	}

	/**
	 *  Flattens `Future<Future<A>>` into `Future<A>`
	 * 
	 * @param FutureObject $f
	 * 
	 * @return FutureObject
	 */
	public static function flatten ($f) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:164: characters 5-29
		return Future_Impl_::flatMap($f, function ($v) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:164: characters 27-28
			return $v;
		});
	}

	/**
	 * @param FutureObject $this
	 * 
	 * @return FutureObject
	 */
	public static function gather ($this1) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:138: characters 5-16
		return $this1;
	}

	/**
	 * @param FutureObject $this
	 * 
	 * @return FutureStatus
	 */
	public static function get_status ($this1) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:39: characters 7-30
		return $this1->getStatus();
	}

	/**
	 *  Registers a callback to handle the future result.
	 *  If the result is already available, the callback will be invoked immediately.
	 *  @return A `CallbackLink` instance that can be used to cancel the callback, no effect if the callback is already invoked
	 * 
	 * @param FutureObject $this
	 * @param \Closure $callback
	 * 
	 * @return LinkObject
	 */
	public static function handle ($this1, $callback) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:59: characters 5-33
		return $this1->handle($callback);
	}

	/**
	 * Merges multiple futures into a `Future<Array<A>>`
	 * The futures are processed simultaneously. Set concurrency to limit how many are processed at a time.
	 * 
	 * @param FutureObject[]|\Array_hx $futures
	 * @param int $concurrency
	 * 
	 * @return FutureObject
	 */
	public static function inParallel ($futures, $concurrency = null) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:209: characters 5-38
		return Future_Impl_::many($futures, $concurrency);
	}

	/**
	 * Merges multiple futures into a `Future<Array<A>>`
	 * The futures are processed one at a time.
	 * 
	 * @param FutureObject[]|\Array_hx $futures
	 * 
	 * @return FutureObject
	 */
	public static function inSequence ($futures) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:216: characters 5-28
		return Future_Impl_::many($futures, 1);
	}

	/**
	 * Creates an irreversible future:
	 * `init` gets called, when the first handler is registered or `eager()` is called.
	 * The future is never suspended again. When possible, use `new Future()` instead.
	 * 
	 * @param \Closure $init
	 * 
	 * @return FutureObject
	 */
	public static function irreversible ($init) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:323: characters 5-66
		return new SuspendableFuture(function ($yield) use (&$init) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:323: characters 45-56
			$init($yield);
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:323: characters 58-62
			return null;
		});
	}

	/**
	 * @param mixed $maybeFuture
	 * 
	 * @return bool
	 */
	public static function isFuture ($maybeFuture) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:308: characters 5-41
		return ($maybeFuture instanceof FutureObject);
	}

	/**
	 * @param LazyObject $l
	 * 
	 * @return FutureObject
	 */
	public static function lazy ($l) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:298: characters 5-29
		return new SyncFuture($l);
	}

	/**
	 * @param FutureObject[]|\Array_hx $a
	 * @param int $concurrency
	 * 
	 * @return FutureObject
	 */
	public static function many ($a, $concurrency = null) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:219: characters 5-65
		return Future_Impl_::processMany($a, $concurrency, Boot::getStaticClosure(Outcome::class, 'Success'), function ($o) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:219: characters 54-64
			return OutcomeTools::orNull($o);
		});
	}

	/**
	 *  Creates a new future by applying a transform function to the result.
	 *  Different from `flatMap`, the transform function of `map` returns a sync value
	 * 
	 * @param FutureObject $this
	 * @param \Closure $f
	 * @param bool $gather
	 * 
	 * @return FutureObject
	 */
	public static function map ($this1, $f, $gather = null) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:95: characters 19-25
		$_g = $this1->getStatus();
		$__hx__switch = ($_g->index);
		if ($__hx__switch === 3) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:97: characters 18-19
			$l = $_g->params[0];
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:97: characters 40-48
			$this2 = $l;
			$f1 = $f;
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:97: characters 22-49
			return new SyncFuture(new LazyFunc(function () use (&$f1, &$this2) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:97: characters 40-48
				return $f1($this2->get());
			}, $this2));
		} else if ($__hx__switch === 4) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:96: characters 23-30
			return Future_Impl_::never();
		} else {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:98: characters 16-78
			return new SuspendableFuture(function ($fire) use (&$f, &$this1) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:98: characters 49-77
				return $this1->handle(function ($v) use (&$f, &$fire) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:98: characters 66-76
					$fire($f($v));
				});
			});
		}
	}

	/**
	 *  Merges two futures into one by applying `combine` on the two future values
	 * 
	 * @param FutureObject $this
	 * @param FutureObject $that
	 * @param \Closure $combine
	 * 
	 * @return FutureObject
	 */
	public static function merge ($this1, $that, $combine) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:144: characters 20-26
		$_g = $this1->getStatus();
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:144: characters 28-39
		$_g1 = $that->getStatus();
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:144: characters 20-26
		if ($_g->index === 4) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:145: characters 45-52
			return Future_Impl_::never();
		} else if ($_g1->index === 4) {
			return Future_Impl_::never();
		} else {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:147: lines 147-156
			return new SuspendableFuture(function ($yield) use (&$that, &$this1, &$combine) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:148: lines 148-153
				$check = function ($v = null) use (&$yield, &$that, &$this1, &$combine) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:149: characters 28-34
					$_g = $this1->getStatus();
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:149: characters 36-47
					$_g1 = $that->getStatus();
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:149: characters 28-34
					if ($_g->index === 3) {
						#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:149: characters 36-47
						if ($_g1->index === 3) {
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:150: characters 37-38
							$b = $_g1->params[0];
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:150: characters 27-28
							$a = $_g->params[0];
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:151: characters 17-37
							$yield($combine(Lazy_Impl_::get($a), Lazy_Impl_::get($b)));
						}
					}
				};
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:155: characters 11-50
				$this2 = $this1->handle($check);
				return new LinkPair($this2, $that->handle($check));
			});
		}
	}

	/**
	 * @return FutureObject
	 */
	public static function never () {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:35: characters 5-27
		return Future_Impl_::$NEVER_INST;
	}

	/**
	 * @param FutureObject $l
	 * 
	 * @return FutureObject
	 */
	public static function neverToAny ($l) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:188: characters 5-18
		return $l;
	}

	/**
	 *  Like `map` and `flatMap` but with a polymorphic transformer and return a `Promise`
	 *  @see `Next`
	 * 
	 * @param FutureObject $this
	 * @param \Closure $n
	 * 
	 * @return FutureObject
	 */
	public static function next ($this1, $n) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:127: characters 5-22
		return Future_Impl_::flatMap($this1, $n);
	}

	/**
	 * @param FutureObject $this
	 * 
	 * @return FutureObject
	 */
	public static function noise ($this1) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:73: lines 73-74
		if ($this1->getStatus()->index === 4) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:73: characters 36-43
			return Future_Impl_::never();
		} else {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:74: characters 12-27
			return Future_Impl_::map($this1, function ($_) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:74: characters 21-26
				return null;
			});
		}
	}

	/**
	 * @param mixed $v
	 * 
	 * @return FutureObject
	 */
	public static function ofAny ($v) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:191: characters 5-26
		return new SyncFuture(new LazyConst($v));
	}

	/**
	 * @param FutureObject[]|\Array_hx $futures
	 * @param bool $gather
	 * 
	 * @return FutureObject
	 */
	public static function ofMany ($futures, $gather = null) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:201: characters 5-31
		return Future_Impl_::inSequence($futures);
	}

	/**
	 *  Same as `first`
	 * 
	 * @param FutureObject $a
	 * @param FutureObject $b
	 * 
	 * @return FutureObject
	 */
	public static function or ($a, $b) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:329: characters 5-22
		return Future_Impl_::first($a, $b);
	}

	/**
	 * @param FutureObject[]|\Array_hx $a
	 * @param int $concurrency
	 * @param \Closure $fn
	 * @param \Closure $lift
	 * 
	 * @return FutureObject
	 */
	public static function processMany ($a, $concurrency, $fn, $lift) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:222: lines 222-294
		if ($a->length === 0) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:223: characters 16-46
			return new SyncFuture(new LazyConst($lift(Outcome::Success(new \Array_hx()))));
		} else {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:224: lines 224-292
			return new SuspendableFuture(function ($yield) use (&$lift, &$fn, &$concurrency, &$a) {
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:225: lines 225-236
				$links = new \Array_hx();
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:226: characters 19-42
				$_g = new \Array_hx();
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:226: characters 20-41
				$_g1 = 0;
				while ($_g1 < $a->length) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:226: characters 25-26
					$x = ($a->arr[$_g1] ?? null);
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:226: characters 20-41
					++$_g1;
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:226: characters 33-41
					$_g->arr[$_g->length++] = null;
				}
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:225: lines 225-236
				$ret = $_g;
				$index = 0;
				$pending = 0;
				$done = false;
				$concurrency1 = null;
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:230: lines 230-236
				if ($concurrency === null) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:225: lines 225-236
					$concurrency1 = $a->length;
				} else {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:232: characters 20-21
					$v = $concurrency;
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:225: lines 225-236
					$concurrency1 = ($v < 1 ? 1 : ($v > $a->length ? $a->length : $v));
				}
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:243: lines 243-251
				$fireWhenReady = function () use (&$yield, &$lift, &$pending, &$index, &$ret, &$done) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:245: lines 245-251
					if ($index === $ret->length) {
						#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:246: lines 246-250
						if ($pending === 0) {
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:247: characters 17-41
							$v = $lift(Outcome::Success($ret));
							$done = true;
							$yield($v);
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:248: characters 17-21
							return true;
						} else {
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:250: characters 20-25
							return false;
						}
					} else {
						#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:251: characters 18-23
						return false;
					}
				};
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:253: lines 253-286
				$step = null;
				$step = function () use (&$step, &$yield, &$lift, &$pending, &$index, &$fireWhenReady, &$fn, &$ret, &$done, &$links, &$a) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:254: lines 254-286
					if (!$done && !$fireWhenReady()) {
						#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:255: lines 255-286
						while ($index < $ret->length) {
							unset($index1, $check);
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:257: characters 27-34
							$index += 1;
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:257: characters 15-35
							$index1 = $index - 1;
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:258: characters 15-32
							$p = ($a->arr[$index1] ?? null);
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:260: lines 260-269
							$check = function ($o) use (&$yield, &$lift, &$index1, &$fireWhenReady, &$fn, &$ret, &$done, &$links) {
								#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:261: characters 24-29
								$_g = $fn($o);
								$__hx__switch = ($_g->index);
								if ($__hx__switch === 0) {
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:262: characters 32-33
									$v = $_g->params[0];
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:263: characters 21-35
									$ret->offsetSet($index1, $v);
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:264: characters 21-36
									$fireWhenReady();
								} else if ($__hx__switch === 1) {
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:265: characters 32-33
									$e = $_g->params[0];
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:266: lines 266-267
									$_g = 0;
									while ($_g < $links->length) {
										#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:266: characters 26-27
										$l = ($links->arr[$_g] ?? null);
										#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:266: lines 266-267
										++$_g;
										#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:267: characters 23-33
										if ($l !== null) {
											$l->cancel();
										}
									}
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:268: characters 21-43
									$v = $lift(Outcome::Failure($e));
									$done = true;
									$yield($v);
								}
							};
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:271: characters 22-30
							$_g = $p->getStatus();
							if ($_g->index === 3) {
								#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:272: characters 28-35
								$_hx_tmp = null;
								$_hx_tmp = Lazy_Impl_::get($_g->params[0]);
								#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:272: characters 39-40
								$v = $_hx_tmp;
								#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:273: characters 19-27
								$check($v);
								#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:274: characters 19-38
								if (!$done) {
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:274: characters 30-38
									continue;
								}
							} else {
								#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:276: characters 19-28
								$pending += 1;
								#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:277: lines 277-283
								$x = $p->handle(function ($o) use (&$step, &$pending, &$done, &$check) {
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:279: characters 23-32
									$pending -= 1;
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:280: characters 23-31
									$check($o);
									#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:281: characters 23-40
									if (!$done) {
										#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:281: characters 34-40
										$step();
									}
								});
								#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:277: lines 277-283
								$links->arr[$links->length++] = $x;
							}
							#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:285: characters 15-20
							break;
						}
					}
				};
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:288: characters 19-23
				$_g = 0;
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:288: characters 23-34
				$_g1 = $concurrency1;
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:288: lines 288-289
				while ($_g < $_g1) {
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:288: characters 19-34
					$i = $_g++;
					#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:289: characters 11-17
					$step();
				}
				#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:291: characters 9-21
				return CallbackLink_Impl_::fromMany($links);
			});
		}
	}

	/**
	 * @param FutureObject $this
	 * @param mixed $v
	 * 
	 * @return FutureObject
	 */
	public static function swap ($this1, $v) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:120: characters 5-23
		return Future_Impl_::map($this1, function ($_) use (&$v) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:120: characters 21-22
			return $v;
		});
	}

	/**
	 *  Creates a sync future.
	 *  Example: `var i = Future.sync(1); // Future<Int>`
	 * 
	 * @param mixed $v
	 * 
	 * @return FutureObject
	 */
	public static function sync ($v) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:305: characters 12-19
		return new SyncFuture(new LazyConst($v));
	}

	/**
	 *  Creates a new `FutureTrigger`
	 * 
	 * @return FutureTrigger
	 */
	public static function trigger () {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:372: characters 5-31
		return new FutureTrigger();
	}

	/**
	 * Add a side effect to be run before the future is handled.
	 * Does not make the future eager.
	 * 
	 * @param FutureObject $this
	 * @param \Closure $c
	 * 
	 * @return FutureObject
	 */
	public static function withSideEffect ($this1, $c) {
		#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:134: characters 5-41
		return Future_Impl_::map($this1, function ($v) use (&$c) {
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:134: characters 23-34
			Callback_Impl_::invoke($c, $v);
			#/home/sinherani/haxelib/tink_core/2,1,1/src/tink/core/Future.hx:134: characters 36-37
			return $v;
		});
	}

	/**
	 * @internal
	 * @access private
	 */
	static public function __hx__init ()
	{
		static $called = false;
		if ($called) return;
		$called = true;


		self::$NOISE = new SyncFuture(new LazyConst(null));
		self::$NEVER_INST = new FutureObject();
		self::$NEVER = Future_Impl_::$NEVER_INST;
	}
}

Boot::registerClass(Future_Impl_::class, 'tink.core._Future.Future_Impl_');
Boot::registerGetters('tink\\core\\_Future\\Future_Impl_', [
	'status' => true
]);
Future_Impl_::__hx__init();
