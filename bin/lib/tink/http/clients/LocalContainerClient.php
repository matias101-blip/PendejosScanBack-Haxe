<?php
/**
 * Generated by Haxe 4.3.6
 */

namespace tink\http\clients;

use \tink\http\IncomingRequest;
use \tink\core\_Future\SyncFuture;
use \php\Boot;
use \tink\http\IncomingResponse;
use \tink\core\Outcome;
use \tink\core\_Lazy\LazyConst;
use \tink\http\IncomingRequestHeader;
use \tink\core\_Future\Future_Impl_;
use \tink\_Url\Url_Impl_;
use \tink\http\ClientObject;
use \tink\http\IncomingRequestBody;
use \tink\http\OutgoingRequest;
use \tink\http\containers\LocalContainer;
use \tink\core\_Future\FutureObject;

class LocalContainerClient implements ClientObject {
	/**
	 * @var LocalContainer
	 */
	public $container;

	/**
	 * @param LocalContainer $container
	 * 
	 * @return void
	 */
	public function __construct ($container) {
		#/home/sinherani/haxelib/tink_http/0,10,0/src/tink/http/clients/LocalContainerClient.hx:15: characters 5-31
		$this->container = $container;
	}

	/**
	 * @param OutgoingRequest $req
	 * 
	 * @return FutureObject
	 */
	public function request ($req) {
		#/home/sinherani/haxelib/tink_http/0,10,0/src/tink/http/clients/LocalContainerClient.hx:19: characters 14-23
		$this1 = $this->container;
		#/home/sinherani/haxelib/tink_http/0,10,0/src/tink/http/clients/LocalContainerClient.hx:21: characters 35-52
		$req1 = $req->header->method;
		#/home/sinherani/haxelib/tink_http/0,10,0/src/tink/http/clients/LocalContainerClient.hx:21: characters 54-82
		$this2 = $req->header->url;
		#/home/sinherani/haxelib/tink_http/0,10,0/src/tink/http/clients/LocalContainerClient.hx:21: characters 9-130
		$this3 = new IncomingRequestHeader($req1, Url_Impl_::fromString(($this2->query === null ? $this2->path : ((($this2->path === null ? "null" : $this2->path))??'null') . "?" . ((($this2->query === null ? "null" : $this2->query))??'null'))), "HTTP/1.1", $req->header->fields);
		#/home/sinherani/haxelib/tink_http/0,10,0/src/tink/http/clients/LocalContainerClient.hx:19: lines 19-28
		return Future_Impl_::flatMap($this1->serve(new IncomingRequest("127.0.0.1", $this3, IncomingRequestBody::Plain($req->body))), function ($res) {
			#/home/sinherani/haxelib/tink_http/0,10,0/src/tink/http/clients/LocalContainerClient.hx:24: lines 24-27
			return new SyncFuture(new LazyConst(Outcome::Success(new IncomingResponse($res->header, $res->body))));
		});
	}
}

Boot::registerClass(LocalContainerClient::class, 'tink.http.clients.LocalContainerClient');
